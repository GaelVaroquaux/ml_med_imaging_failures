var shared_numbers={},shared_errors={},shared_collections={},shared_html={},shared_selection={},shared_strings={},shared_http={},shared_storage={},shared_location={},shared_state={},shared_requests={},shared_events={},shared_features={},shared_templates={},shared_messaging={},config_config={},shared_scroll={},iframe_host={},entry_point_launcher={},entry_point_entry_point={};shared_numbers=function(t){function e(t,e){return Math.floor(Math.random()*(e-t+1))+t}return t.randomInteger=e,t}(shared_numbers);var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};shared_errors=function(t){var e=function(){function t(){}return t.unhandled=function(t){r.log(t)},t.capture=function(e){return function(){try{e()}catch(e){t.unhandled(e)}}},t}();t.UnhandledError=e;var n=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(Error);t.NoSuchElement=n;var r=function(){function t(){}return t.log=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];t.enabled&&console.log(e,n)},t.enable=function(e){t.enabled=e},t.isDebug=function(t){return t.indexOf("uptodate-debug=true")!=-1},t.enabled=!1,t}();return t.Debug=r,t}(shared_errors);var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};shared_collections=function(t,e,n){function r(t){for(var n=t.length-1;n>0;n--){var r=e.randomInteger(0,n),o=t[n];t[n]=t[r],t[r]=o}return t}function o(t){var e=new s;if(!t)return e;for(var n=0;n<t.length;++n)e.push(t[n]);return e}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n={},r=function(e){var r=t[e];return null==r?"continue":void Object.keys(r).forEach(function(t){n[t]=r[t]})},o=0;o<t.length;o++)r(o);return n}t.shuffle=r;var s=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.each=function(t){for(var e=0;e<this.length;++e)t(this[e],e);return this},e.prototype.map=function(t){var n=new e;return this.each(function(e,r){n.push(t(e,r))}),n},e.prototype.flatMap=function(t,n){return void 0===n&&(n=new e),this.each(function(e,r){var o=t(e,r);Array.prototype.push.apply(n,o)}),n},e.prototype.filter=function(t){var n=new e;return this.each(function(e,r){t(e)&&n.push(e)}),n},e.prototype.find=function(t){return this.filter(t).head()},e.prototype.as=function(t){var e=this;return e.filter(function(e){return e instanceof t})},e.prototype.head=function(){return this[0]},e.prototype.last=function(){if(this.isEmpty())throw new n.NoSuchElement;return this[this.length-1]},e.prototype.isEmpty=function(){return 0==this.length},e.prototype.groupBy=function(t){return this.reduce(function(n,r){var o=t instanceof Function?t(r):r[t];return(n[o]=n[o]||new e).push(r),n},{})},e}(Array);return t.List=s,t.list=o,t.mergeObjects=i,t}(shared_collections,shared_numbers,shared_errors),shared_html=function(t,e,n){function r(t,e){for(var n=i(e),r=0;r<n.length;r++){var o=n[r];t.appendChild(o)}return t}function o(t){return void 0!==t.outerHTML}function i(t){var e=document.createElement("div");return e.innerHTML=o(t)?t.outerHTML:t,e.childNodes}function s(t,e){for(var n=t.parentNode,r=i(e),o=0;o<r.length;o++){var s=r[o];n.insertBefore(s,t)}return t}function a(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){for(var n=0;n<t.length;n++){var r=t[n];Object.keys(r).forEach(function(t){var n=r[t],o=typeof n;switch(o){case"function":e.setAttribute(t,n(e.getAttribute(t)));break;case"boolean":n?e.setAttribute(t,""):e.removeAttribute(t);break;case"object":e.setAttribute(t,JSON.stringify(n));break;default:e.setAttribute(t,n)}})}return e}}function c(t,e,n,r){"string"==typeof e&&(e=[e]);for(var o=0;o<e.length;o++){var i=e[o];t.addEventListener(i,function(t){var e=n(t);e||(t.preventDefault(),t.stopPropagation())},r)}}function u(){return"BackCompat"==document.compatMode?document.body:document.documentElement}function l(t){return void 0===t&&(t=u()),t.scrollHeight>t.clientHeight}function h(t){return void 0===t&&(t=u()),t.scrollWidth>t.clientWidth}function f(t){return n.select("dt",t).reduce(function(t,e){return t[e.textContent.trim()]=e.nextElementSibling.textContent.trim(),t},{})}var p=function(){function t(){}return t.path=function(t){for(var n=new e.List;t;)n.push(t),t=t.parentElement;return n},t.matches=function(t,e){return t.matches=t.matches||t.msMatchesSelector||function(t){return!1},t.matches(e)},t.calculateBoxShadow=function(e){try{var n=t.path(e).map(function(t){return window.getComputedStyle(t).boxShadow}).find(function(t){return"none"!=t});return parseInt(n.split("px ")[2])}catch(t){return 0}},t}();return t.Elements=p,t.appendHtml=r,t.isHTML=o,t.parseHtml=i,t.insertHtml=s,t.attributes=a,t.on=c,t.root=u,t.hasVerticalScrollBar=l,t.hasHorizontalScrollBar=h,t.dataListObject=f,t}(shared_html,shared_collections,shared_selection);var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};shared_selection=function(t,e,n){function r(t,e){function n(e,n){for(var r=n.querySelectorAll(t),o=0;o<r.length;++o)e.push(r[o]);return e}void 0===e&&(e=document);var r=new i;if("string"!=typeof t)return r.push(t),r;if(e instanceof i){for(var o=0;o<e.length;o++){var s=e[o];n(r,s)}return r}return n(r,e)}function o(t,e){return void 0===e&&(e=document),e.querySelector(t)}var i=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.on=function(t,e,r){return this.each(function(o){n.on(o,t,function(t){return e(o,t)},r)})},r.prototype.attr=function(t,e){return null==e?this.map(function(e){return e.getAttribute(t)}):this.each(function(n){n.setAttribute(t,e)})},r.prototype.removeAttr=function(t){return this.each(function(e){e.removeAttribute(t)})},r.prototype.prop=function(t,e){return null==e?this.map(function(e){return e[t]}):this.each(function(n){n[t]=e})},r.prototype.text=function(t){return null==t?this.map(function(t){return t.textContent}):this.each(function(e){e.textContent=t})},r.prototype.html=function(t){return null==t?this.map(function(t){return t.innerHTML}):this.each(function(e){e.innerHTML=t})},r.prototype.css=function(t,e){return null==e?this.map(function(e){return window.getComputedStyle(e).getPropertyValue(t)}):this.each(function(n){n.style[t]=e})},r.prototype.append=function(t){return this.map(function(e){return n.appendHtml(e,t)}),this},r.prototype.appendTo=function(t){return this.each(function(e){t.appendChild(e)})},r.prototype.insert=function(t){return this.map(function(e){return n.insertHtml(e,t)}),this},r.prototype.remove=function(t){return void 0===t&&(t=function(t){return!0}),this.each(function(e){t&&e.parentNode.removeChild(e)})},r.prototype.children=function(){return this.flatMap(function(t){return e.list(t.childNodes)},new r)},r.prototype.detach=function(){var t=document.createDocumentFragment();return this.each(function(e){t.appendChild(e)}),t},r.prototype.clone=function(){var t=document.createDocumentFragment();return this.each(function(e){t.appendChild(e.cloneNode(!0))}),t},r.prototype.show=function(){return this.each(function(t){t.style.display=""})},r.prototype.hide=function(){return this.each(function(t){t.style.display="none"})},r.prototype.addClass=function(t){return this.each(function(e){e.classList.add(t)})},r.prototype.removeClass=function(t){return this.each(function(e){e.classList.remove(t)})},r}(e.List);return t.Select=i,t.select=r,t.get=o,t}(shared_selection,shared_collections,shared_html),shared_strings=function(t){function e(t){return null==t||""==t}function n(t){if("undefined"==typeof t||"undefined"==t)return null;try{return JSON.parse(t)}catch(e){return t}}function r(t,e){return 0==e.indexOf(t)}function o(t,e){return e.indexOf(t)==e.length-t.length}return t.isEmpty=e,t.coerce=n,t.startsWith=r,t.endsWith=o,t}(shared_strings),shared_http=function(t,e,n){function r(n,r){if(void 0===r&&(r=t.fireAndForget),JSON.stringify(n)==JSON.stringify(c))return e.Debug.log("duplicate request",n,c),function(){};c=n;var o=new XMLHttpRequest;o.open(n.method,n.url,!0),o.withCredentials=!0;var i=n.headers||{};return Object.keys(i).forEach(function(t){o.setRequestHeader(t,i[t])}),o.addEventListener("readystatechange",e.UnhandledError.capture(function(){if(4==o.readyState){var t=o.getAllResponseHeaders().split("\n").reduce(function(t,e){var n=e.split(": ");return t[n[0]]=n[1],t},{});r({status:o.status,headers:t,entity:new a(o.responseText)})}})),o.send(n.entity),function(){o.abort()}}function o(t){var e=document.createElement("a");return e.href=t,{scheme:e.protocol?e.protocol.replace(/(:$)/,""):"",host:e.hostname,authority:e.host,path:0===e.pathname.indexOf("/")?e.pathname:"/"+e.pathname,query:e.search?e.search.replace(/(^\?)/,""):"",fragment:e.hash?e.hash.replace(/(^#)/,""):"",toString:function(){var t=[];return""!=this.scheme&&(t.push(this.scheme),t.push(":")),""!=this.authority&&(t.push("//"),t.push(this.authority)),t.push(this.path),""!=this.query&&(t.push("?"),t.push(this.query)),""!=this.fragment&&(t.push("#"),t.push(this.fragment)),t.join("")}}}function i(t){void 0===t&&(t=document.location.href);var e=o(t).query;return""==e?{}:e.split("&").map(function(t){return t.split("=")}).reduce(function(t,e){var r=e[0],o=n.coerce(e[1]),i=t[r];return"undefined"==typeof i?t[r]=o:"object"==typeof i?i.push(o):t[r]=[i,o],t},{})}function s(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n];null==r?e.push(encodeURIComponent(n)):"object"==typeof r?r.forEach(function(t){e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}),e.join("&")}var a=function(){function t(t){this.content=t}return t.prototype.xml=function(){return(new DOMParser).parseFromString(this.content,"application/xml")},t.prototype.text=function(){return this.content},t.prototype.json=function(){return JSON.parse(this.content)},t.prototype.html=function(){return(new DOMParser).parseFromString(this.content,"text/html")},t}();t.Entity=a,t.fireAndForget=function(t){};var c={};t.http=r,t.uri=o,t.queryObject=i,t.toQueryString=s;var u=function(){function t(){}return t.baseUrl=function(t){var e={regex:new RegExp("(https?://[^/]+/[^/]+/).*"+t),process:function(t){return t.match(e.regex)[1]}};try{throw new Error}catch(n){try{return e.process(n.stack)}catch(n){return e.process(document.querySelector('script[src$="'+t+'"]').src)}}},t.origin=function(t){var e=document.createElement("a");return e.href=t,e.protocol+"//"+e.host},t}();return t.BaseUrl=u,t}(shared_http,shared_errors,shared_strings),shared_storage=function(t,e){function n(){try{var t="uptodate-test",e="works";window.localStorage.setItem(t,e);var n=window.localStorage.getItem(t);return window.localStorage.removeItem(t),e===n}catch(t){return!1}}function r(t){void 0===t&&(t=window.localStorage);for(var n={},r=0;r<t.length;r++){var o=t.key(r);n[o]=e.coerce(t.getItem(o))}return n}function o(t,n,r){Object.keys(t).forEach(function(o){if(e.startsWith(r,o)){var i=t[o];null==i||"undefined"==typeof i?n.removeItem(o):n.setItem(o,i)}})}return t.LOCALSTORAGE_KEY="uptodate-user-id",t.hasStorage=n,t.storageObject=r,t.copyIntoStorage=o,t}(shared_storage,shared_strings),shared_location=function(t,e,n,r,o){var i=function(){function t(e,n,r,o,i,s,a,c,u,l){void 0===e&&(e=t.extractType()),void 0===n&&(n=t.extractDisplayType()),void 0===r&&(r=t.extractDesignType()),void 0===o&&(o=t.extractDoi()),void 0===i&&(i=t.extractIssn()),void 0===s&&(s=window.location.href),void 0===a&&(a=t.extractHostsite(s)),void 0===c&&(c=t.extractMetaData(e)),void 0===u&&(u=t.extractSessionIds()),void 0===l&&(l=!1),this.type=e,this.display_type=n,this.design_type=r,this.doi=o,this.issn=i,this.url=s,this.hostsite=a,this.meta_data=c,this.session_ids=u,this.browser_extension_loaded=l,this.dois=o?[o]:[]}return t.prototype.checkForBrowserExtension=function(t,e){if("chrome"in window&&t){var n=this;window.chrome.runtime.sendMessage(t,{type:"browserExtensionInstalledRequest"},function(t){n.browser_extension_loaded=!!t,e()})}else e()},t.extractSessionIds=function(){var t=[];if(o.hasStorage()){var e=window.localStorage.getItem(o.LOCALSTORAGE_KEY);null!=e&&t.push(e)}return t},t.extractHostsite=function(t){var e,r=n.uri(t),o=n.queryObject(t)["uptodate-hostsite"];return e=o?o:r.authority,e.indexOf("recommendations.springernature.com")!=-1||e.indexOf("recommended.springernature.com")!=-1?"recommended":e.indexOf("nature.com")!=-1?"nature":e.indexOf("springer.com")!=-1?"springer":e.indexOf("biomedcentral.com")!=-1?"biomedcentral":e.indexOf("springeropen.com")!=-1?"springeropen":e.indexOf("localhost")!=-1?"localhost":"unknown"},t.prototype.toQuery=function(){return encodeURIComponent(this.json())},t.prototype.json=function(){return JSON.stringify(this)},t.extractDisplayType=function(){return e.get(t.inlineSelector,document)?"inline":"popup"},t.extractDesignType=function(){return e.get("link[href*=mosaic], meta[name='WT.template'][content=mosaic]",document)?"mosaic":"unknown"},t.extractType=function(){var n=t.extractDoi();if(n)return"article";var r=e.select("meta[name='citation_article_type'], meta[name='WT.cg_s'], meta[name='dc.type']").attr("content").head();if(r){var o=r.toLowerCase();if("latest research"==o&&(o="research"),"jobs"==o&&(o="job"),t.allowedTypes.indexOf(o)!=-1)return o}return 0==document.title.indexOf("Table of contents")?"issue":"Natureevents"==e.select("meta[name='WT.cg_n']").attr("content").head()?"event":"Home"==e.select("meta[name='WT.page_categorisation']").attr("content").head()?"journalHomepage":null},t.extractMetaData=function(t){switch(t){case"job":return{job:{id:e.select("meta[name='DCSext.job_id']").attr("content").head(),title:e.select("meta[name='description']").attr("content").head(),location:e.select("meta[name='Job Location']").attr("content").head(),employer:e.select("meta[name='Job Employer']").attr("content").head(),employer_id:e.select("meta[name='DCSext.employer_id']").attr("content").head(),type:e.select("meta[name='Job Type']").attr("content").head(),qualifications:e.select("meta[name='Job Qualifications']").attr("content").head()}};case"event":var n=r.dataListObject(e.get('dl[class="event-details"]'));return{event:{id:e.select("meta[name='DCSext.event_id']").attr("content").head(),title:document.title.trim(),organization:n["Organization:"],type:n["Type:"],venue:n["Venue:"],location:n["Location:"],website:n["Website:"],area:n.Area,specialty:n.Specialty,subject:n.Subject}}}return{}},t.extractDoi=function(){var n=e.select("meta[name='citation_doi'], meta[name='dc.identifier'], meta[name='DC.identifier'], meta[name='prism.doi'], meta[name='dc.Identifier'], meta[property='citation_doi']").attr("content");return n.isEmpty()&&(n=e.select("a[ref='aid_type=doi']").text()),n.isEmpty()&&(n=e.select("meta[name='citation_arxiv_id']").attr("content").map(function(t){return"arxiv:"+t})),n.map(function(e){if(!e)return null;var n=e.match(t.doiRegex);return null!=n?n[1]:null}).filter(function(t){return null!=t}).head()},t.extractIssn=function(){var t=e.select("meta[name='citation_issn'], meta[name='prism.issn'], meta[name='prism.eIssn']").attr("content").head();if(t)return t.toUpperCase();var n=e.select(".issn, .eissn").text().head(),r=n?n.match(this.issnRegex):null;return r?r[0].toUpperCase():null},t.inlineSelector="div[data-rel='uptodate-inline'], link[rel='uptodate-inline']",t.allowedTypes=["article","research","issue","homepage","job","event"],t.trackTypes=["article","job","event"],t.doNotDisplay=["job","event"],t.doiRegex=/.*(10\.\d{4,9}\/[-._;()\/:A-Z0-9]+).*/i,t.issnRegex=/\d{4}\-\d{3}[\dxX]/i,t}();return t.CurrentLocation=i,t}(shared_location,shared_selection,shared_http,shared_html,shared_storage),shared_state=function(t,e,n,r,o,i,s){function a(t,e,n){return void 0===e&&(e=new r.CurrentLocation),void 0===n&&(n=window.screen),h.toUnderscore({config:t,current_location:e,screen:n})}function c(t){return null!=t&&t.constructor==Array}function u(t){return null!=t&&"object"==typeof t}t.state=a;var l=function(){function t(t,e){void 0===e&&(e=new o.ConsoleEventHandler),this.root=t,this.events=e,this.capture(),this.setInitialState()}return t.prototype.capture=function(){var t=this;i.on(this.root,"change",function(e){var n=e.target;return i.Elements.matches(n,".state[name][value]")&&t.setState(n),i.Elements.matches(n,"[data-event-subject][data-event-action][data-event-object]")&&t.trackEvent(n),!0},!0),i.on(this.root,["click","contextmenu"],function(e){var n=o.Events.path(e).find(function(t){return i.Elements.matches(t,":not(.state)[data-event-object]")});return n&&t.trackEvent(n),!0},!0)},t.prototype.setState=function(t){var n=e.get("input[name="+t.name+"]",this.root),r=n.getAttribute("state-new")||"",o=t.value;r!=o&&(n.setAttribute("state-old",r),n.setAttribute("state-new",o))},t.prototype.trackEvent=function(t){var e=this.dataAttributes(t);this.events.fire(encodeURIComponent(t.getAttribute("data-event-subject")),encodeURIComponent(t.getAttribute("data-event-action")),encodeURIComponent(t.getAttribute("data-event-object")),e)},t.prototype.dataAttributes=function(t,e){var r=this;return void 0===e&&(e={}),s.list(t.attributes).filter(function(t){return n.startsWith("data-",t.name)}).filter(function(t){return!n.startsWith("data-event",t.name)}).reduce(function(t,e){return t[encodeURIComponent(e.name.replace("data-",""))]=r.getAttributeValue(e),t},e)},t.prototype.getAttributeValue=function(t){try{return JSON.parse(t.value)}catch(e){return t.value}},t.prototype.setInitialState=function(){var t=this;e.select(".state[name][value]:not([state-new]):checked",this.root).as(HTMLInputElement).each(function(n){var r=e.get("input[name="+n.name+"]",t.root);r.setAttribute("state-new",r.defaultValue)})},t}();t.StateChange=l,t.isArray=c,t.isObject=u;var h=function(){function t(){}return t.toUnderscore=function(t){return this.map(t,function(t){return t.replace(/-/g,"_")})},t.toHyphen=function(t){return this.map(t,function(t){return t.replace(/_/g,"-")})},t.map=function(t,e){var n=this;if(c(t)){var r=t;return r.reduce(function(t,r){return t.push(n.map(r,e)),t},[])}if(u(t)){var o={};for(var i in t){var s=t[i];null!=s&&"function"!=typeof s&&(o[e(i)]=this.map(s,e))}return o}return t},t}();return t.Converter=h,t}(shared_state,shared_selection,shared_strings,shared_location,shared_events,shared_html,shared_collections),shared_requests=function(t){var e=function(){function t(){}return t.config=function(t,e){return{method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain"},url:t+"user/config",entity:JSON.stringify(e)}},t.postEvent=function(t){return{method:"POST",url:t.config.host+"events/"+encodeURIComponent(t.event.subject)+"_"+encodeURIComponent(t.event.action)+"_"+encodeURIComponent(t.event.object),headers:{"Content-Type":"text/plain"},entity:JSON.stringify(t)}},t.get=function(t){return{method:"GET",url:t}},t.recommendations=function(t){return{method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain"},url:t.config.host+"recommendations",entity:JSON.stringify(t)}},t.jobRecommendations=function(t){return t.config.number_of_recommendations=3,{method:"POST",headers:{Accept:"application/json","Content-Type":"text/plain"},url:t.config.host+"recommendations/jobs",entity:JSON.stringify(t)}},t}();return t.Requests=e,t}(shared_requests),shared_events=function(t,e,n,r,o,i){var s=function(){function t(){}return t.prototype.fire=function(t,e,n,r){console.log&&console.log("Event: "+t+" "+e+" "+n+" -> "+JSON.stringify(r))},t}();t.ConsoleEventHandler=s;var a=function(){function t(t){this.state=t}return t.prototype.fire=function(t,i,s,a){r.http(n.Requests.postEvent(e.Converter.toUnderscore(o.mergeObjects(this.state,{event:{subject:t,action:i,object:s,data:a,client_time:this.toIsoStringWithOffset(new Date)}}))))},t.prototype.toIsoStringWithOffset=function(t){var e=-t.getTimezoneOffset(),n=e>=0?"+":"-",r=function(t){var e=Math.abs(Math.floor(t));return(e<10?"0":"")+e};return t.getFullYear()+"-"+r(t.getMonth()+1)+"-"+r(t.getDate())+"T"+r(t.getHours())+":"+r(t.getMinutes())+":"+r(t.getSeconds())+n+r(e/60)+":"+r(e%60)},t.create=function(t,e){if(void 0===e&&(e={bubbles:!0,cancelable:!0,detail:null}),e.detail)try{return new CustomEvent(t,e)}catch(r){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}else try{return new Event(t,e)}catch(n){var r=document.createEvent("Event");return r.initEvent(t,e.bubbles,e.cancelable),r}},t.path=function(t){return i.Elements.path(t.target)},t}();return t.Events=a,t}(shared_events,shared_state,shared_requests,shared_http,shared_collections,shared_html),shared_features=function(t,e){var n=function(){function t(t){this.events=t}return t.prototype.check=function(t){this.has("web-storage",function(){return e.hasStorage()})&&this.has("web-messaging",function(){return window.postMessage})&&this.has("selector-api",function(){return document.querySelectorAll})&&this.has("Object.keys",function(){return Object.keys})&&this.has("Array.prototype.map",function(){return Array.prototype.map})&&this.has("Array.prototype.filter",function(){return Array.prototype.filter})&&t()},t.prototype.has=function(t,e){try{if(e())return!0}catch(t){}return this.missing(t),!1},t.prototype.missing=function(t){this.events.fire("client","missing","feature",{feature:t})},t}();return t.Features=n,t}(shared_features,shared_storage),shared_templates=function(t,e){var n=function(){function t(){}return t.clone=function(t){return this.polyfill(t),t.ownerDocument.importNode(t.content,!0)},t.polyfill=function(t){t.content||(t.content=e.select(t).children().detach())},t.polyfillTemplates=function(t){var n=this;e.select("template",t).each(function(t){return n.polyfill(t)})},t}();return t.Templates=n,t}(shared_templates,shared_selection),shared_messaging=function(t,e,n,r,o){var i=function(){function t(){}return t.fireResize=function(e,n,r){var i,s=r||"resize";if(n instanceof HTMLElement){var a=o.Elements.calculateBoxShadow(n);i={width:n.offsetWidth+a+"px",height:n.offsetHeight+a+"px"}}else i=n;t.dispatch(e,{name:s,body:i})},t.dispatch=function(t,n){t.dispatchEvent(e.Events.create("client_message",{bubbles:!0,cancelable:!0,detail:n}))},t}();t.MessageDispatcher=i;var s=function(){function t(t,e){var o=this;this.window=t,this.expectedOrigin=e,t.addEventListener("message",function(i){var s=n.uri(i.origin).host,a=n.uri(e).host;if(s!=a)return void r.Debug.log("Origin host did not match expected: expectedHost:"+a+" actualHost:"+s);var c=i.data;r.Debug.log(t.name+" received message from "+e+" : "+c.name+" -> "+JSON.stringify(c.body));var u=o[c.name];if(!u)return void r.Debug.log("No slot called "+c.name+" found");try{u.call(o,c.body)}catch(t){r.UnhandledError.unhandled(t)}},!0)}return t}();t.MessageReceiver=s;var a=function(){function t(t,e){this.windows=t,this.destinationOrigin=e}return t.prototype.send=function(t,e){var n=this;this.windows.forEach(function(r){r.postMessage({name:t,body:e},n.destinationOrigin)})},t}();return t.MessageSender=a,t}(shared_messaging,shared_events,shared_http,shared_errors,shared_html),config_config=function(t,e,n,r,o,i,s,a,c){var u=function(){function t(n,o){var i=this;this.parent=o,this.storage=window.localStorage,this.parent.config=this,e.copyIntoStorage(s.queryObject(n.current_location.url),this.storage,t.prefix),this.data=this.migrate(c.mergeObjects(n.config,t.extractConfig(e.storageObject(this.storage)))),this.render(),r.select("#"+this.id("debug")).on("change",function(t){i.debug(t.checked)}),this.persist("debug",null),this.debug(a.Debug.isDebug(n.current_location.url))}return t.extractConfig=function(e){var r=this;return Object.keys(e).reduce(function(o,i){if(n.startsWith(r.prefix,i)){var s=i.substr(t.prefix.length);o[s]=e[i]}return o},{})},t.prototype.json=function(){return JSON.stringify(this.data)},t.prototype.render=function(){var t=this;Object.keys(this.data).forEach(function(e){t.createProperty(e,t.data[e])})},t.prototype.createProperty=function(t,e){var i=this.id(t),s=typeof e,a=r.get("#"+i,this.parent);if(a)"boolean"==s?a.checked=e:a.value=JSON.stringify(e);else{var c=r.get("template.config",this.parent),u=o.Templates.clone(c);a=r.get("input",u),"boolean"==s?a.setAttribute("type","checkbox"):"number"==s?a.setAttribute("type","number"):a.setAttribute("type","text"),a.setAttribute("id",i),a.classList.add(t.replace(/_/g,"-")),"boolean"==s?e?a.setAttribute("checked",""):a.removeAttribute("checked"):a.setAttribute("value",JSON.stringify(e));var l=r.get("label",u);l.setAttribute("for",i);var h=r.get(".text",l);h.textContent=t.replace(/_/g," "),this.parent.insertBefore(u,c.nextSibling)}Object.defineProperty(this.data,t,{enumerable:!0,get:function(){return"boolean"==s?a.checked:n.coerce(a.value)},set:function(t){return"boolean"==s?a.checked=t:a.value=JSON.stringify(t)}})},t.prototype.id=function(e){return t.prefix+e.replace(/_/g,"-")},t.prototype.debug=function(t){a.Debug.enable(t),this.full_screen(t),t?this.parent.classList.add("debug"):this.parent.classList.remove("debug")},t.prototype.full_screen=function(t){i.MessageDispatcher.dispatch(this.parent,{name:"full_screen",body:t})},t.prototype.persist=function(e,n){var r=t.prefix+e;null==n?this.storage.removeItem(r):this.storage.setItem(r,n)},t.prototype.isPersisted=function(e){var n=t.prefix+e;return null!==this.storage.getItem(n)},t.prototype.migrate=function(t){return this.migrateProperty(t,"closed-pre-rec-email","email-journey-closed"),t},t.prototype.migrateProperty=function(t,e,n){var r=t[e];"undefined"!=typeof r&&(t[n]=r,this.isPersisted(e)&&(this.persist(e,null),this.persist(n,r)))},t.prefix="uptodate-",t}();return t.Config=u,t}(config_config,shared_storage,shared_strings,shared_selection,shared_templates,shared_messaging,shared_http,shared_errors,shared_collections),shared_scroll=function(t,e,n){var r=function(){function t(t){this.config=t}return t.prototype.required=function(){return e.hasVerticalScrollBar()&&!this.hasScrolledEnough()},t.prototype.hasScrolledEnough=function(){return window.pageYOffset>this.config.minimum_scroll_height},t.prototype.await=function(t){var e=this,n=function(){e.hasScrolledEnough()&&(window.removeEventListener("scroll",n),t())};window.addEventListener("scroll",n)},t}();t.WindowScrollCondition=r;var o=function(){function t(t,e,n){var r=this;this.sender=t,this.receiver=e,this.state=n,this.receiver.scroll_info=function(t){return r.scroll_info(t)},this.receiver.scroll_bars_response=function(t){return r.scroll_bars_response(t)},this.sender.send("scroll_bars_request")}return t.prototype.scroll_bars_response=function(t){this.scrollBars=t},t.prototype.scroll_info=function(t){if(this.scrollInfo=t,this.done&&this.hasScrolledEnough()){var e=this.done;this.done=null,this.sender.send("scroll_info_stop"),e()}},t.prototype.required=function(){return this.scrollBars&&this.scrollBars.vertical&&!this.hasScrolledEnough()},t.prototype.getScrolledPosOffset=function(t,e){var n=this.state.config.experiment_popup_scroll_position?.75:1,r=e-t,o=r*(1-n);return o},t.prototype.hasScrolledEnough=function(){if(this.scrollInfo&&this.scrollInfo.targetClientRect){if(0===this.scrollInfo.targetClientRect.top&&0===this.scrollInfo.targetClientRect.bottom)return!1;var t=this.scrollInfo.targetClientRect.top,e=this.scrollInfo.targetClientRect.bottom;if("inline"===this.state.current_location.display_type)return e>0&&t<this.scrollInfo.windowHeight;var n=this.getScrolledPosOffset(t,e);return e<0||e-n<this.scrollInfo.windowHeight}return this.scrollInfo&&this.scrollInfo.y>this.state.config.minimum_scroll_height},t.prototype.await=function(t){this.done=t,this.sender.send("scroll_info_start")},t}();t.ClientScrollListener=o;var i=function(){function t(t,e,n){var r=this;this.sender=t,this.receiver=e,this.state=n,this.receiver.jobs_scroll_info=function(t){return r.scroll_info(t)},this.receiver.jobs_scroll_bars_response=function(t){return r.scroll_bars_response(t)},this.sender.send("jobs_scroll_bars_request")}return t.prototype.scroll_bars_response=function(t){this.scrollBars=t},t.prototype.scroll_info=function(t){if(this.scrollInfo=t,this.done&&this.hasScrolledEnough()){var e=this.done;e(),this.done=null,this.sender.send("jobs_scroll_info_stop")}},t.prototype.required=function(){return!this.hasScrolledEnough()},t.prototype.hasScrolledEnough=function(){if(this.scrollInfo&&this.scrollInfo.targetClientRect){if(0===this.scrollInfo.targetClientRect.top&&0===this.scrollInfo.targetClientRect.bottom)return!1;var t=this.scrollInfo.targetClientRect.top,e=this.scrollInfo.targetClientRect.bottom;return e>0&&t<this.scrollInfo.windowHeight}return this.scrollInfo&&this.scrollInfo.y>this.state.config.minimum_scroll_height},t.prototype.await=function(t){this.done=t,this.sender.send("jobs_scroll_info_start")},t}();t.JobClientScrollListener=i;var s=function(){function t(t,e,n){var r=this;this.sender=t,this.receiver=e,this.state=n,this.receiver.scroll_info_start=function(){return r.start()},this.receiver.scroll_info_stop=function(){return r.stop()},this.receiver.scroll_bars_request=function(){return r.scroll_bars_request()}}return t.prototype.scroll_bars_request=function(){this.sender.send("scroll_bars_response",{vertical:e.hasVerticalScrollBar(),horizontal:e.hasHorizontalScrollBar()})},t.prototype.start=function(){var t=this;this.handler=window.setInterval(function(){function e(){var t="div#abstract",e="section[aria-labelledby='abstract'], section[aria-labelledby='Abs1']",r="section.Abstract";return n.get(t+", "+e+", "+r)}function r(t,e){var n=e.getBoundingClientRect();return t.windowHeight=window.innerHeight,t.targetClientRect={top:n.top,bottom:n.bottom},t}var o={x:window.pageXOffset,y:window.pageYOffset},i=null,s=null;"inline"===t.state.current_location.display_type&&(i=n.get("#uptodate-client"))?o=r(o,i):(s=e())&&(o=r(o,s)),t.sender.send("scroll_info",o)},250)},t.prototype.stop=function(){window.clearInterval(this.handler)},t}();t.HostScrollListener=s;var a=function(){function t(t,e,n){var r=this;this.sender=t,this.receiver=e,this.state=n,this.receiver.jobs_scroll_info_start=function(){return r.start()},this.receiver.jobs_scroll_info_stop=function(){return r.stop()},this.receiver.jobs_scroll_bars_request=function(){return r.scroll_bars_request()}}return t.prototype.scroll_bars_request=function(){this.sender.send("jobs_scroll_bars_response",{vertical:e.hasVerticalScrollBar(),horizontal:e.hasHorizontalScrollBar()})},t.prototype.start=function(){var t=this;this.handler=window.setInterval(function(){var e=n.get("#job-client");if(e){var r=e.getBoundingClientRect(),o={x:window.pageXOffset,y:window.pageYOffset,windowHeight:window.innerHeight,targetClientRect:{top:r.top,bottom:r.bottom}};t.sender.send("jobs_scroll_info",o)}},250)},t.prototype.stop=function(){window.clearInterval(this.handler)},t}();return t.JobHostScrollListener=a,t}(shared_scroll,shared_html,shared_selection);var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)};iframe_host=function(t,e,n,r,o,i,s){var a=function(t){function a(s,a,c,u){var l=r.BaseUrl.origin(s);t.call(this,window,l),o.Debug.log("Host expecting to send and receive messages from "+l),this.state=u,this.style={width:"0",height:"0"},this.articleIframe=this.createIframe(""+s+a+"?source="+r.BaseUrl.origin(window.location.href),"uptodate-client"),this.appendArticleIframe();var h=[this.articleIframe.contentWindow],f=i.get("span[data-recommended='jobs']");u.config.jobs&&f&&(this.jobIframe=this.createIframe(""+s+c+"?source="+r.BaseUrl.origin(window.location.href),"job-client"),this.appendJobIframe(f),this.jobIframe.style.marginTop="28px",h.push(this.jobIframe.contentWindow)),this.sender=new n.MessageSender(h,l),new e.HostScrollListener(this.sender,this,this.state),
new e.JobHostScrollListener(this.sender,this,this.state)}return __extends(a,t),a.prototype.state_request=function(){this.sender.send("state_response",this.state)},a.prototype.job_state_request=function(){this.sender.send("job_state_response",this.state)},a.prototype.inline_css_request=function(){this.linkToCss&&this.sender.send("inline_css_response",this.linkToCss.toString())},a.prototype.resize=function(t){this.fullScreen?this.style=t:(this.articleIframe.style.width=t.width,this.articleIframe.style.height=t.height)},a.prototype.jobResize=function(t){this.jobIframe.style.width=t.width,this.jobIframe.style.height=t.height},a.prototype.inlineEvent=function(t){if(this.state.config.inline_version)if("uptodate-no-content"==t)this.articleIframe.style.display="none";else if("uptodate-display"==t){var e=i.get(".uptodate-recommendations-off",document);e&&(e.classList.remove("uptodate-recommendations-off"),e.classList.add("uptodate-recommendations-on"))}},a.prototype.full_screen=function(t){t&&!this.state.config.inline_version?(this.articleIframe.style.width="100%",this.articleIframe.style.height="100%"):(this.articleIframe.style.width=this.style.width,this.articleIframe.style.height=this.style.height),this.fullScreen=t&&!("inline"===this.state.current_location.display_type)},a.prototype.createIframe=function(t,e){var n=document.createElement("iframe");return n.style.width="0",n.style.height="0",n.style.bottom="0",n.style.right="0",n.style.zIndex="100000",n.frameBorder="0",n.scrolling="no",n.src=t,n.name=e,n.id=e,n.title="Personalised recommendations",n.setAttribute("allowtransparency","true"),n},a.prototype.appendArticleIframe=function(){var t=this.getInlineElement();if(t&&this.state.config.inline_version){var e=null==t.getAttribute("href")?t.getAttribute("data-href"):t.getAttribute("href");this.linkToCss=r.uri(e);var n=parseInt(window.getComputedStyle(t.parentElement)["padding-left"].replace("px","")),o=t.parentElement.offsetWidth-2*n+"px";this.articleIframe.style.width=o,this.style.width=o,t.parentElement.replaceChild(this.articleIframe,t)}else this.articleIframe.style.position="fixed",document.body.appendChild(this.articleIframe)},a.prototype.appendJobIframe=function(t){t&&(t.parentElement.replaceChild(this.jobIframe,t),this.jobIframe.style.padding="0",this.jobIframe.style.width="100%")},a.prototype.getInlineElement=function(){return i.get(s.CurrentLocation.inlineSelector,document)},a}(n.MessageReceiver);return t.Host=a,t}(iframe_host,shared_scroll,shared_messaging,shared_http,shared_errors,shared_selection,shared_location),entry_point_launcher=function(t,e,n,r,o,i,s,a,c,u,l,h,f){function p(t,e){try{var r=new s.CurrentLocation;a.http(c.Requests.config(e,r),function(e){if(200==e.status){var o=u.Config.extractConfig(a.queryObject(r.url)),i=l.mergeObjects(e.entity.json(),o);r.checkForBrowserExtension(i["browser-extension-id"],function(){var e=n.state(i,r);1==e.config.experiment_srep_homepage&&"journalHomepage"!=e.current_location.type&&(e.config.experiment_srep_homepage=!1),t(e,function(t){return new d(t,function(t){new h.Host(i.host,"generated/client.html","generated/job-client.html",t)})})})}})}catch(t){o.UnhandledError.unhandled(t)}}var d=function(){function t(t,n,r){void 0===r&&(r=new e.Events(t)),this.state=t,this.done=n,this.events=r,o.Debug.enable(o.Debug.isDebug(t.current_location.url)),this.state.config=t.config,this.updateLocalStorage(),this.trackCurrentPage(),this.display()}return t.prototype.updateLocalStorage=function(){if(f.hasStorage()){var t=this.state.config.user_id;o.Debug.log("Storing user-id: "+t+" in local storage"),window.localStorage.setItem(f.LOCALSTORAGE_KEY,t)}},t.prototype.trackCurrentPage=function(){s.CurrentLocation.trackTypes.indexOf(this.state.current_location.type)!=-1&&this.events.fire("website","displays",this.state.current_location.type)},t.prototype.display=function(){var t=this;(!r.isEmpty(this.state.current_location.type)||"nature"==this.state.current_location.hostsite&&"inline"==this.state.current_location.display_type)&&s.CurrentLocation.doNotDisplay.indexOf(this.state.current_location.type)==-1&&(!r.isEmpty(this.state.current_location.issn)||"homepage"==this.state.current_location.type&&"recommended"==this.state.current_location.hostsite)&&("journalHomepage"==this.state.current_location.type&&1!=this.state.config.experiment_srep_homepage||this.state.config.show_recommendations&&(window.screen.availWidth<this.state.config.minimum_width&&"inline"!=this.state.current_location.display_type||(this.state.config.minimised=this.autoMinimise(),new i.Features(this.events).check(function(){try{t.done(t.state)}catch(t){o.Debug.log(t)}}))))},t.prototype.autoMinimise=function(){return this.state.config.autominimise?window.screen.availWidth<1920:this.state.config.minimised},t}();return t.Launcher=d,t.entryPoint=p,t}(entry_point_launcher,shared_events,shared_state,shared_strings,shared_errors,shared_features,shared_location,shared_http,shared_requests,config_config,shared_collections,iframe_host,shared_storage),entry_point_entry_point=function(t,e,n){return e.entryPoint(function(t,e){e(t)},n.BaseUrl.baseUrl("entry-point.js")),t}(entry_point_entry_point,entry_point_launcher,shared_http);
//# sourceMappingURL=entry-point.js.map
